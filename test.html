<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Formulaire HubSpot – Auto Remplissage du Champ URL</title>

  <!-- Load official HubSpot Forms library -->
  <script src="https://js.hsforms.net/forms/v2.js"></script>
</head>

<body>
  <h1>Contact</h1>
  <p>Le champ <code>lien_residence</code> sera automatiquement rempli avec l’URL actuelle de la page.</p>

  <!-- Container where the HubSpot form will load -->
  <div id="hubspot-form"></div>

  <script>
    // Wait until HubSpot script has fully loaded
    window.addEventListener('load', function() {

      if (typeof hbspt === 'undefined' || !hbspt.forms) {
        console.error('❌ HubSpot library did not load correctly.');
        return;
      }

      // Create the form
      hbspt.forms.create({
        region: "na1",
        portalId: "45176032",
        formId: "4a868650-22f3-4bb5-a389-259d208f3973",
        target: "#hubspot-form",

        onFormReady: function () {
          console.log('✅ HubSpot form loaded');

          function setLienResidence() {
            const field = document.querySelector('input[name*="lien_residence"]');
            if (field) {
              field.value = window.location.href;
              console.log("✅ Champ lien_residence rempli avec :", field.value);
              return true;
            }
            return false;
          }

          // Keep trying for a short period in case the field renders late
          let attempts = 0;
          const intervalId = setInterval(() => {
            attempts++;
            if (setLienResidence() || attempts > 10) {
              clearInterval(intervalId);
            }
          }, 300);

          // Ensure final update before submission
          const formElement = document.querySelector('#hubspot-form form');
          if (formElement) {
            formElement.addEventListener('submit', function() {
              setLienResidence();
            });
          }
        }
      });
    });
  </script>
</body>
</html>
